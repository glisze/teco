#
# This makefile builds TECOC on a Sun running the SunOS operating system.
# Before running it,  inspect the lines between here and the line containing
# all #'s to select the way you want TECO-C built.

# If you want to compile with built-in debugging support,  uncomment the
# following line.  When debugging is compiled in,  the control-P command
# can be used to turn on function tracing or get views of internal data
# structures (see the DbgDsp function in tecoc.c). Compiling in this support
# makes TECO-C larger and a little slower,  so you should only use this
# when you're debugging TECO-C.

#DEBG = -DDEBUGGING

# If you're debugging TECO-C,  use this option to compile in a consistency
# checking function called after each command executes.  The function checks
# the sanity of TECO-C's internal variables.  This obviously slows things
# down a little.

#CCHEK = -DCONSISTENCY_CHECKING

# Include files for SunOS 4.0 are different than for 4.1 (4.1's are closer
# to the ANSI Standard).  Define OSVERS as -DSUNOS4_0 if you're running
# 4.0,  so functions get properly declared (and to keep gcc from bitching).

#OSVERS = -DSUNOS4_0

# To choose the compiler you want to use,  uncomment one of the following
# sets of lines (between here and the line containing all "#" characters).

# If you want to compile with video support,  uncomment the following lines,
# which use the System V compiler and compile/link using System V include
# files and libraries.  I've found that I get "undefined symbol" errors if I
# don't unsetenv the LD_LIBRARY_PATH environment variable before linking
# with this set of lines.
#
# Note that compiling in video support is a mixed blessing.  If you use
# TECO-C exclusively in video mode,  there are no problems.  If you turn
# video off (using a 0,7:w command) you'll notice that typeout is very slow.
# This is an artifact of curses.  To get fast typeout,  build TECO-C without
# video (use one of the other sets of lines below).

#CC = /usr/5bin/cc
#CFLAGS = ${OSVERS}${DEBG}${CCHEK} -DCURSES -O -pipe
#TERMOBJS = -lcurses

# If you want to the standard compiler,  uncomment the following line.

# CFLAGS = $(OSVERS) ${DEBG} ${CCHEK} -O -pipe
# TERMOBJS = -ltermcap

# If you want to use gcc,  uncomment the following lines,  which override the
# COMPILE.c macro so it doesn't stick in the -target option, which gcc
# doesn't understand.

CC= gcc
CFLAGS= ${OSVERS} ${DEBG} ${CCHEK} -DCURSES -static -O -Wall -Wshadow -Wpointer-arith -Wcast-qual
#TERMOBJS = -ltermcap
TERMOBJS = `pkg-config --libs ncurses` -ltinfo
COMPILE.c = $(CC) $(CFLAGS) $(CPPFLAGS) -c -g

#############################################################################

CFILES=	baksrc.c bldstr.c clenup.c cmatch.c docjr.c doeves.c doflag.c \
	echoit.c err.c exea.c exeats.c exeb.c exebar.c exebsl.c exec.c \
	execcc.c execln.c execom.c execrt.c execst.c execta.c exectc.c \
	exectd.c execte.c execti.c exectl.c exectn.c execto.c exectp.c \
	exectq.c exectr.c exects.c exectt.c exectu.c exectv.c exectw.c \
	exectx.c execty.c exectz.c exed.c exedgt.c exedot.c exedqu.c \
	exee.c exeequ.c exeesc.c exeexc.c exeey.c exef.c exefb.c exeg.c \
	exegtr.c exeh.c exei.c exeill.c exej.c exek.c exel.c exelbr.c \
	exelst.c exem.c exen.c exenul.c exenyi.c exeo.c exeopr.c exep.c \
	exeprc.c exepw.c exeq.c exeqes.c exer.c exerbr.c exertp.c exes.c \
	exescl.c exet.c exeu.c exeund.c exeusc.c exev.c exew.c exex.c \
	exey.c exez.c findes.c findqr.c flowec.c flowee.c flowel.c \
	getara.c getnma.c inccbp.c init.c insstr.c isradx.c ln2chr.c \
	makdbf.c makrom.c popmac.c pshmac.c pushex.c rdline.c rdpage.c \
	readcs.c replac.c search.c singlp.c skpcmd.c srclop.c sserch.c \
	tabort.c typbuf.c typest.c uminus.c wrpage.c zfrsrc.c zunix.c

OBJECTS= $(CFILES:.c=.o)

tecoc: tecoc.o ${OBJECTS}
	${LINK.c} -s -o $@ tecoc.o ${OBJECTS} ${TERMOBJS}

tecoc.o: tecoc.c zport.h tecoc.h deferr.h dchars.h chmacs.h

clpars.h: genclp clpars.tec
	genclp

genclp: genclp.o
	${LINK.c} -o $@ genclp.o

genclp.o: genclp.c

clean:
	@for i in makedep? ${OBJECTS} ; do \
		if [ -f $$i ] ; then rm $$i ; fi ; \
	done
	rm -f tecoc tecoc.o core

tags:
	etags *.c *.h

lint:
# b = report unreachable break statements
# c = complain about casts with questionable portability
# h = apply heuristic tests
# x = report unused externs
	lint -bchx -DSUNOS4_0 tecoc.c ${CFILES}


#
#  Invoking this target (with "make depend") causes a new version of this
#  file to be created.  This current version will be saved in a file named
#  "makefile.bak".  In the new file, the lines following the special "DO NOT
#  DELETE" line will be replaced with a new set of dependency rules.
#

depend: makedep
	@echo '/^# DO NOT DELETE THIS LINE/+1,$$d' >makedep0
	@echo '$$r makedep5' >>makedep0
	@echo 'w' >>makedep0
	@cp makefile makefile.bak
	@ed - makefile < makedep0
	@rm makedep?
	@echo "new version of makefile generated, old version in makefile.bak"

makedep: FRC
	@cat /dev/null >makedep5
	@echo "generating include file dependency list..."
	@-(for i in ${CFILES} ; do \
		${CPP} -M $$i >> makedep1; done) 2>makedepe
	@echo "generating new version of makefile..."
	@sed -e 's|: ./|: |' makedep1 > makedep2
	@awk ' { if ($$1 != prev)                              \
			{ print rec; rec = $$0; prev = $$1; }  \
		   else                                        \
			{ if (length(rec $$2) > 70)            \
				{ print rec; rec = $$0; }      \
			  else                                 \
				rec = rec " " $$2              \
			}                                      \
	       }                                               \
	       END { print rec }                               \
	     '                                                 \
	     makedep2 >makedep3
	@awk '/:/ {printf "%s\n", $$0}' \
	     makedep3 >makedep4
	@sed -e 's|:|:|' makedep4 > makedep5
	@cat makedepe
	@(if [ -s makedepe ]; then false; fi)
FRC:


# DO NOT DELETE THIS LINE -- make depend uses it
baksrc.o: baksrc.c /usr/include/stdc-predef.h zport.h
bldstr.o: bldstr.c /usr/include/stdc-predef.h zport.h
clenup.o: clenup.c /usr/include/stdc-predef.h zport.h
cmatch.o: cmatch.c /usr/include/stdc-predef.h zport.h
docjr.o: docjr.c /usr/include/stdc-predef.h zport.h
doeves.o: doeves.c /usr/include/stdc-predef.h zport.h
doflag.o: doflag.c /usr/include/stdc-predef.h zport.h
echoit.o: echoit.c /usr/include/stdc-predef.h zport.h
err.o: err.c /usr/include/stdc-predef.h zport.h
exea.o: exea.c /usr/include/stdc-predef.h zport.h
exeats.o: exeats.c /usr/include/stdc-predef.h zport.h
exeb.o: exeb.c /usr/include/stdc-predef.h zport.h
exebar.o: exebar.c /usr/include/stdc-predef.h zport.h
exebsl.o: exebsl.c /usr/include/stdc-predef.h zport.h
exec.o: exec.c /usr/include/stdc-predef.h zport.h
execcc.o: execcc.c /usr/include/stdc-predef.h zport.h
execln.o: execln.c /usr/include/stdc-predef.h zport.h
execom.o: execom.c /usr/include/stdc-predef.h zport.h
execrt.o: execrt.c /usr/include/stdc-predef.h zport.h
execst.o: execst.c /usr/include/stdc-predef.h zport.h
execta.o: execta.c /usr/include/stdc-predef.h zport.h
exectc.o: exectc.c /usr/include/stdc-predef.h zport.h
exectd.o: exectd.c /usr/include/stdc-predef.h zport.h
execte.o: execte.c /usr/include/stdc-predef.h zport.h
execti.o: execti.c /usr/include/stdc-predef.h zport.h
exectl.o: exectl.c /usr/include/stdc-predef.h zport.h
exectn.o: exectn.c /usr/include/stdc-predef.h zport.h
execto.o: execto.c /usr/include/stdc-predef.h zport.h
exectp.o: exectp.c /usr/include/stdc-predef.h zport.h
exectq.o: exectq.c /usr/include/stdc-predef.h zport.h
exectr.o: exectr.c /usr/include/stdc-predef.h zport.h
exects.o: exects.c /usr/include/stdc-predef.h zport.h
exectt.o: exectt.c /usr/include/stdc-predef.h zport.h
exectu.o: exectu.c /usr/include/stdc-predef.h zport.h
exectv.o: exectv.c /usr/include/stdc-predef.h zport.h
exectw.o: exectw.c /usr/include/stdc-predef.h zport.h
exectx.o: exectx.c /usr/include/stdc-predef.h zport.h
execty.o: execty.c /usr/include/stdc-predef.h zport.h
exectz.o: exectz.c /usr/include/stdc-predef.h zport.h
exed.o: exed.c /usr/include/stdc-predef.h zport.h
exedgt.o: exedgt.c /usr/include/stdc-predef.h zport.h
exedot.o: exedot.c /usr/include/stdc-predef.h zport.h
exedqu.o: exedqu.c /usr/include/stdc-predef.h zport.h
exee.o: exee.c /usr/include/stdc-predef.h zport.h
exeequ.o: exeequ.c /usr/include/stdc-predef.h zport.h
exeesc.o: exeesc.c /usr/include/stdc-predef.h zport.h
exeexc.o: exeexc.c /usr/include/stdc-predef.h zport.h
exeey.o: exeey.c /usr/include/stdc-predef.h zport.h
exef.o: exef.c /usr/include/stdc-predef.h zport.h
exefb.o: exefb.c /usr/include/stdc-predef.h zport.h
exeg.o: exeg.c /usr/include/stdc-predef.h zport.h
exegtr.o: exegtr.c /usr/include/stdc-predef.h zport.h
exeh.o: exeh.c /usr/include/stdc-predef.h zport.h
exei.o: exei.c /usr/include/stdc-predef.h zport.h
exeill.o: exeill.c /usr/include/stdc-predef.h zport.h
exej.o: exej.c /usr/include/stdc-predef.h zport.h
exek.o: exek.c /usr/include/stdc-predef.h zport.h
exel.o: exel.c /usr/include/stdc-predef.h zport.h
exelbr.o: exelbr.c /usr/include/stdc-predef.h zport.h
exelst.o: exelst.c /usr/include/stdc-predef.h zport.h
exem.o: exem.c /usr/include/stdc-predef.h zport.h
exen.o: exen.c /usr/include/stdc-predef.h zport.h
exenul.o: exenul.c /usr/include/stdc-predef.h zport.h
exenyi.o: exenyi.c /usr/include/stdc-predef.h zport.h
exeo.o: exeo.c /usr/include/stdc-predef.h zport.h
exeopr.o: exeopr.c /usr/include/stdc-predef.h zport.h
exep.o: exep.c /usr/include/stdc-predef.h zport.h
exeprc.o: exeprc.c /usr/include/stdc-predef.h zport.h
exepw.o: exepw.c /usr/include/stdc-predef.h zport.h
exeq.o: exeq.c /usr/include/stdc-predef.h zport.h
exeqes.o: exeqes.c /usr/include/stdc-predef.h zport.h
exer.o: exer.c /usr/include/stdc-predef.h zport.h
exerbr.o: exerbr.c /usr/include/stdc-predef.h zport.h
exertp.o: exertp.c /usr/include/stdc-predef.h zport.h
exes.o: exes.c /usr/include/stdc-predef.h zport.h
exescl.o: exescl.c /usr/include/stdc-predef.h zport.h
exet.o: exet.c /usr/include/stdc-predef.h zport.h
exeu.o: exeu.c /usr/include/stdc-predef.h zport.h
exeund.o: exeund.c /usr/include/stdc-predef.h zport.h
exeusc.o: exeusc.c /usr/include/stdc-predef.h zport.h
exev.o: exev.c /usr/include/stdc-predef.h zport.h
exew.o: exew.c /usr/include/stdc-predef.h zport.h
exex.o: exex.c /usr/include/stdc-predef.h zport.h
exey.o: exey.c /usr/include/stdc-predef.h zport.h
exez.o: exez.c /usr/include/stdc-predef.h zport.h
findes.o: findes.c /usr/include/stdc-predef.h zport.h
findqr.o: findqr.c /usr/include/stdc-predef.h zport.h
flowec.o: flowec.c /usr/include/stdc-predef.h zport.h
flowee.o: flowee.c /usr/include/stdc-predef.h zport.h
flowel.o: flowel.c /usr/include/stdc-predef.h zport.h
getara.o: getara.c /usr/include/stdc-predef.h zport.h
getnma.o: getnma.c /usr/include/stdc-predef.h zport.h
inccbp.o: inccbp.c /usr/include/stdc-predef.h zport.h
init.o: init.c /usr/include/stdc-predef.h zport.h
insstr.o: insstr.c /usr/include/stdc-predef.h zport.h
isradx.o: isradx.c /usr/include/stdc-predef.h zport.h
ln2chr.o: ln2chr.c /usr/include/stdc-predef.h zport.h
makdbf.o: makdbf.c /usr/include/stdc-predef.h zport.h
makrom.o: makrom.c /usr/include/stdc-predef.h zport.h
popmac.o: popmac.c /usr/include/stdc-predef.h zport.h
pshmac.o: pshmac.c /usr/include/stdc-predef.h zport.h
pushex.o: pushex.c /usr/include/stdc-predef.h zport.h
rdline.o: rdline.c /usr/include/stdc-predef.h zport.h
rdpage.o: rdpage.c /usr/include/stdc-predef.h zport.h
readcs.o: readcs.c /usr/include/stdc-predef.h zport.h
replac.o: replac.c /usr/include/stdc-predef.h zport.h
search.o: search.c /usr/include/stdc-predef.h zport.h
singlp.o: singlp.c /usr/include/stdc-predef.h zport.h
skpcmd.o: skpcmd.c /usr/include/stdc-predef.h zport.h
srclop.o: srclop.c /usr/include/stdc-predef.h zport.h
sserch.o: sserch.c /usr/include/stdc-predef.h zport.h
tabort.o: tabort.c /usr/include/stdc-predef.h zport.h
typbuf.o: typbuf.c /usr/include/stdc-predef.h zport.h
typest.o: typest.c /usr/include/stdc-predef.h zport.h
uminus.o: uminus.c /usr/include/stdc-predef.h zport.h
wrpage.o: wrpage.c /usr/include/stdc-predef.h zport.h
zfrsrc.o: zfrsrc.c /usr/include/stdc-predef.h zport.h
zunix.o: zunix.c /usr/include/stdc-predef.h /usr/include/sys/types.h
